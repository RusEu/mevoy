{% extends 'layout_1.html' %}
{% load staticfiles %}

{% block content %}
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    {% include 'partials/breadcrumb.html' with page_name="Calendar" %}

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-md-3">
          <div class="box box-solid">
            <div class="box-header with-border">
              <h4 class="box-title">Labels</h4>
            </div>
            <div class="box-body">
              <!-- the events -->
              <div id="calendar-labels">
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /. box -->
        </div>
        <!-- /.col -->
        <div class="col-md-9">
          <div class="box box-primary">
            <div class="box-body no-padding">
              <!-- THE CALENDAR -->
              <div id="calendar"></div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /. box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js">
  </script>
<script src="{% static 'plugins/fullcalendar/fullcalendar.min.js' %}"></script>
<!-- Page specific script -->
<script>
 function addLabels(users){
     users.forEach(function(user) {
         var label = "<div class='external-event "+ user.color_class +"'>" + user.name + "</div>";
         $('#calendar-labels').append(label);
     })
 }
 $(function () {

     /* initialize the calendar
        -----------------------------------------------------------------*/
     var events = [];
     var fullcalendar_config = {
         header: {
             left: 'prev,next today',
             center: 'title',
             right: 'month,agendaWeek,agendaDay'
         },
         buttonText: {
             today: 'today',
             month: 'month',
             week: 'week',
             day: 'day'
         },
         //Random default events
         events: events,
         editable: false,
         droppable: false,
     }
     $.post("/calendar/api/", { "request_type": {{ request_type }} })
      .done(function( data ) {
          addLabels(data.users);
          data.events.forEach(function(event){
              events.push({
                  title: event.title,
                  start: new Date(event.start),
                  end: new Date(event.end),
                  backgroundColor: event.backgroundColor,
                  borderColor: event.backgroundColor
              })
          })
          $('#calendar').fullCalendar(fullcalendar_config);
      });
 });
</script>

{% endblock %}
